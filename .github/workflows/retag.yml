name: Retag Image
on:
  workflow_dispatch:
    inputs:
      current_tag:
        description: "The existing tag on the image to retag"
        required: true
      new_tag:
        description: "The new tag to apply to the image"
        required: true
jobs:
  retag-image:
    runs-on: ubuntu-latest
    permissions:
      packages: write
    env:
      REGISTRY: ghcr.io
      IMAGE_NAME: ${{ github.repository }}
    steps:
      - uses: docker/login-action@c94ce9fb468520275223c153574b00df6fe4bcc9 # v3.7.0
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - run: |
          docker pull \
            "${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ inputs.current_tag }}"
          docker tag \
            "${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ inputs.current_tag }}" \
            "${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ inputs.new_tag }}"
          docker push \
            "${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ inputs.new_tag }}"
